NMP timeout => bad mcumgr config in prj.conf

Images:
Split status: N/A (0)


TODO:

zephyrproject/blinky => build_mcumgr (test if different / required settings)

regarder smp_svr sur zephyr_sdk



MCUmgr commands:

/*mcumgr conn add test1 type=serial connstring=COM10*/

mcumgr -c test1 echo hello

mcumgr -c test1 image list

mcumgr -c test1 image upload -e zephyr.signed.bin

mcumgr -c test1 image list

mcumgr -c test1 image confirm 0f295fc86cdd59244e2339ef6f206a335dedabcbbce9239f3d0c8e3ddbfe4f1b
mcumgr -c test1 image confirm 24a6fe883a67ca6ae4b776a1c8f4db5d7a0edafa408aea10d609cf8285e98391
mcumgr -c test1 image confirm 95e07d0847d9c924831806be2bbc5ae3db957ec2b1eaf4073214a9d99e0723c6 && mcumgr -c test1 reset
mcumgr -c test1 image confirm dc8fdcdc83e81ee56ad7916e9d194a6f9da73eac3c46d3a6faaf6d02a8789622

mcumgr -c test1 image test a5d5d245f692d1bb9ffb2bc2bcdf90336d7934fdceb5d6cdb78752600aa6be3e

mcumgr -c test1 reset


NCS Bootloader commands:

cd c:\ncs\v2.5.2

west build -b nrf5340dk_nrf5340_cpuapp -d build_mcuboot_manual bootloader\mcuboot\boot\zephyr

west flash -d build_mcuboot_manual 



set ZEPHYR_BASE=c:\ncs\zephyr_clean\zephyrproject\zephyr

set ZEPHYR_BASE=c:\users\trovallet\Documents\Stage\zephyrproject\zephyr

echo %ZEPHYR_BASE%



VENV CLEAN ZEPHYRPROJECT

cd c:/ncs/zephyr_clean

zephyrproject\.venv\Scripts\activate.bat

cd zephyrproject

west update

west zephyr-export


CLEAN ZEPHYRPROJECT Bootloader S
_________________________________

cd c:\ncs\zephyr_clean\zephyrproject

west build -b nrf5340dk_nrf5340_cpuapp -d c:/users/trovallet/documents/Stage/zephyrproject/build_mcuboot_manual c:/users/trovallet/documents/Stage/zephyrproject/bootloader/mcuboot/boot/zephyr -p

west flash -d build_mcuboot_manual


CLEAN ZEPHYRPROJECT Bootloader NS
_________________________________

cd c:\ncs\zephyr_clean\zephyrproject

west build -b nrf5340dk_nrf5340_cpuapp_ns -d c:/ncs/zephyr_clean/zephyrproject/build_mcuboot_manual_ns c:/ncs/zephyr_clean/zephyrproject/bootloader/mcuboot/boot/zephyr -p

west flash -d build_mcuboot_manual_ns


CLEAN ZEPHYRPROJECT Application commands:


BLINKY_DFU_TEST
_______________

west build --build-dir c:/ncs/apps/zephyr_apps/blinky_dfu_test/build_s c:/ncs/apps/zephyr_apps/blinky_dfu_test --pristine --board nrf5340dk_nrf5340_cpuapp -p --no-sysbuild -- -DCONF_FILE=c:/ncs/apps/zephyr_apps/blinky_dfu_test/prj.conf

west flash -d c:/ncs/apps/zephyr_apps/blinky_dfu_test/build_s

mcumgr -c test1 image upload -e c:/ncs/apps/zephyr_apps/blinky_dfu_test/build_s/zephyr/zephyr.signed.bin

---------			----------------------				----------

BLINKY(mcumgr_boot_s)
___________________

west build --build-dir c:/ncs/apps/zephyr_apps/blinky/build_mcumgr_boot_manual c:/ncs/apps/zephyr_apps/blinky --pristine --board nrf5340dk_nrf5340_cpuapp -p --no-sysbuild -- -DCONF_FILE=c:/ncs/apps/zephyr_apps/blinky/prj_boot_mcumgr.conf

west build --build-dir c:/users/trovallet/Documents/Stage/zephyrproject/zephyr_apps/blinky/build_mcumgr_boot_manual c:/users/trovallet/Documents/Stage/zephyrproject/zephyr_apps/blinky --pristine --board thingy91_nrf9161_ns -p --no-sysbuild -- -DCONF_FILE=c:/users/trovallet/Documents/Stage/zephyrproject/zephyr_apps/blinky/prj_boot_mcumgr.conf

west flash -d c:/ncs/apps/zephyr_apps/blinky/build_mcumgr_boot_manual

mcumgr -c test1 image upload -e c:/ncs/apps/zephyr_apps/blinky/build_mcumgr_boot_manual/zephyr/zephyr.signed.bin

---------			----------------------				----------

BLINKY(mcumgr_boot_ns)
___________________

west build --build-dir c:/ncs/apps/zephyr_apps/blinky/build_mcumgr_boot_manual_ns c:/ncs/apps/zephyr_apps/blinky --pristine --board nrf5340dk_nrf5340_cpuapp_ns -p --no-sysbuild -- -DCONF_FILE=c:/ncs/apps/zephyr_apps/blinky/prj_boot_mcumgr.conf

west flash -d c:/ncs/apps/zephyr_apps/blinky/build_mcumgr_boot_manual_ns

mcumgr -c test1 image upload -e c:/ncs/apps/zephyr_apps/blinky/build_mcumgr_boot_manual_ns/zephyr/zephyr.signed.bin

---------			----------------------				----------

BLINKY(ns)
___________________

west build --build-dir c:/ncs/apps/zephyr_apps/blinky/build_manual_ns c:/ncs/apps/zephyr_apps/blinky --pristine --board nrf5340dk_nrf5340_cpuapp_ns -p --no-sysbuild -- -DCONF_FILE=c:/ncs/apps/zephyr_apps/blinky/prj.conf

west flash -d c:/ncs/apps/zephyr_apps/blinky/build_manual_ns

mcumgr -c test1 image upload -e c:/ncs/apps/zephyr_apps/blinky/build_manual_ns/zephyr/zephyr.signed.bin

---------			----------------------				----------

BLINKY_4_DFU_TEST (s)
_________________

west build --build-dir c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/build_s c:/ncs/apps/zephyr_apps/blinky_4_dfu_test --pristine --board nrf5340dk_nrf5340_cpuapp -p --no-sysbuild -- -DCONF_FILE=c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/prj.conf

west flash -d c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/build_s

mcumgr -c test1 image upload -e c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/build_s/zephyr/zephyr.signed.bin


---------			----------------------				----------

BLINKY_4_DFU_TEST (ns)
_________________

west build --build-dir c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/build_ns c:/ncs/apps/zephyr_apps/blinky_4_dfu_test --pristine --board nrf5340dk_nrf5340_cpuapp_ns -p --no-sysbuild -- -DCONF_FILE=c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/prj.conf

west build --build-dir c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/build_ns c:/ncs/apps/zephyr_apps/blinky_4_dfu_test --pristine --board nrf5340dk_nrf5340_cpuapp_ns -p -- -DCONF_FILE=c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/prj_tfm.conf

west flash -d c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/build_ns

mcumgr -c test1 image upload -e c:/ncs/apps/zephyr_apps/blinky_4_dfu_test/build_ns/zephyr/zephyr.signed.bin


---------			----------------------				----------

HELLO_WORLD (s)
_________________

west build --build-dir c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world/build_5340_s c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world --pristine --board nrf5340dk/nrf5340/cpuapp -p --no-sysbuild -- -DCONF_FILE=c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world/prj_boot_mcumgr.conf

west flash -d c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world/build_5340_s

mcumgr -c test1 image upload -e c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world/build_5340_s/zephyr/zephyr.signed.bin


---------			----------------------				----------

HELLO_WORLD (ns)
_________________

west build --build-dir c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world/build_5340_ns c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world --pristine --board nrf5340dk/nrf5340/cpuapp/ns -p --no-sysbuild -- -DCONF_FILE=c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world/prj_boot_mcumgr.conf

west flash -d c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world/build_5340_ns

mcumgr -c test1 image upload -e c:/users/trovallet/documents/Stage/zephyrproject/zephyr_apps/hello_world/build_5340_ns/zephyr/zephyr.signed.bin




CONFIRM

mcumgr -c test1 image confirm 2d4fef70067e9ead06c0336a5dd40d67a70071a3a29e0386399c12efd8fa8f01




TEST

mcumgr -c test1 image test 051f4e0f49128dc2cd846cf8cdd5a987fdb21a434493bd41eb7bd4c3656b6271



hashes:

2d4fef70067e9ead06c0336a5dd40d67a70071a3a29e0386399c12efd8fa8f01
672d778c3bff460e84cc44ceb292e09bf4249b135ba42d30154731df6b926a9b
d6fc9de38b5e33c1944c2d98325475321e35e7e2f8222cf8403c27afb93d1417
21c52682d26fa27f92427e04e3669e891efbd5352c0ecd8ce3200d126a4ec6fc
49316beccdcec4d9af62227dd5262435f67b91d3ac6939a284e9c24fa564f67d
91a247a266a5ca72b1a7aa590af96f996754d235a73bdea6064c97a1595802fa
c1c98f00f1038089b2c9334dc98e02108d6172c5426096bed1333f577bbfa972
8f91c47ac57c75079080dcc202632b8d6014742fd655ebcf02da2178034e02cf
d2b1a94b58ec33f281e90e4c0e1d1e719c10cc79e1e78380dddd650167855896
e360c752691085389270d3b17b358b3cb3902e821685a4b03afcaf8a03afef66
6c6259fe5e2f620f9e02b986e731ad89e11b56e1a1b7de68e1e94b139a126c12
290902017207448e91d01c320711d03ddc6b153f6e8b51216decaac80be324f3
f2068b7432760062f6ae9a91851df68fa6a9780d43303bd99f563b6898191cfa
33c20f506a70f9139b8897ed83b04fd13cfd09cdc1d541e7beaec6567cb666a8
2d741ab3da275995b435a7a03e3504d00c10182c368203f1f703e63a282588db
051f4e0f49128dc2cd846cf8cdd5a987fdb21a434493bd41eb7bd4c3656b6271
da25ba81548915e0c07d5c27f0cf3976ebf4f076888fa14bcfc257809f7c6213



/!\ NEW CONFIG NEEDED FROM HERE /!\
/!\ USE IT AT YOUR OWN RISK /!\

---------			----------------------				----------

TFM_PSA_TEMPLATE (update_ns)
_________________

mcumgr -c test1 image upload -e c:/ncs/apps/ncs_apps/tfm_psa_template/build_update/zephyr/app_update.bin


---------			----------------------				----------

TFM_HELLO_WORLD (boot_dfu_full_ns)
_________________

mcumgr -c test1 image upload -e c:/ncs/apps/ncs_apps/tfm_hello_world/build_boot_dfu_full_ns/zephyr/app_update.bin


---------			----------------------				----------

TFM_HELLO_WORLD (boot_dfu_lite_ns)
_________________

mcumgr -c test1 image upload -e c:/ncs/apps/ncs_apps/tfm_hello_world/build_boot_dfu_lite_ns/zephyr/app_update.bin


---------			----------------------				----------

TFM_HELLO_WORLD (boot_dfu_min_ns)
_________________

mcumgr -c test1 image upload -e c:/ncs/apps/ncs_apps/tfm_hello_world/build_boot_dfu_min_ns/zephyr/app_update.bin


---------			----------------------				----------

TFM_PSA_TEMPLATE_NO_UP_ONLY (update_ns)
_________________

mcumgr -c test1 image upload -e c:/ncs/apps/ncs_apps/tfm_psa_template_no_up_only/build_update_ns/zephyr/app_update.bin

---------			----------------------				----------

TFM_PSA_TEMPLATE_NO_UP_ONLY (ns_no_boot_conf)
_________________

mcumgr -c test1 image upload -e c:/ncs/apps/ncs_apps/tfm_psa_template_no_up_only/build_ns_no_boot_conf/zephyr/app_update.bin






CONFIRM

mcumgr -c test1 image confirm eab41dcfdb4100e74b095481d1b87ce0f6f1b78df9a337ef4740c99c0fd64474




TEST

mcumgr -c test1 image test 051f4e0f49128dc2cd846cf8cdd5a987fdb21a434493bd41eb7bd4c3656b6271


hashes:

eab41dcfdb4100e74b095481d1b87ce0f6f1b78df9a337ef4740c99c0fd64474
a0c2919cb623a2c1155a9f75b15065b7e53c4bcbb5e4e15dfa76fa41d921e230
86f966e7d4fcbf0a951c9864df6c63695eb67be3ad59f05dbf3f51eb4c2f19c2
2184f397bf8806a1e9c69d4830e1780d863edfb0227b6027b581fa0812ff6112
68f1e1529ccd4e62ef769bcf5137979dc2ca1cb88f0a6cd9d66f2d34ec74f331
95e6c8ba37c3d8dddb34bd1f9c465252a8da47c2ae521bd71fa0b88858d97cec
d58635d19c6c71fd504ad246c7b655f9114f4bd3f71e27b6d8b1d60c3ea89404
063462cda7f4d0aaa0cf83c0835a747258e320ee104e46125ec5babd821fd2be
fc374302ea3d599fc699e1fe17f6144d23375f5b137b2e49a9d155e868cf1e21
4109726b121c2a7cfc3fc34e963862f7a8c0f8a74a5da26c27f852c34a233653
ab1e05dac98624ac7ba428e00d0e300c2164b76b57ad0027be2793fe588d7a5c
a483cd728f2d6121c1cade315d32e9d59b12a1f75c572ce5052c315e1151ba5d
f06660289ee485491a2aa32c08e2528f5b2265ac7feef7402f4da221c9c3e646
c5a457f2af62e35eb0908ce7ccd45572ad0d234ba2559b9915038e6b781497ed
c5a457f2af62e35eb0908ce7ccd45572ad0d234ba2559b9915038e6b781497ed
26501671865bed7e25ee7154bc5201c6bda58c33d1bf8259433da0e85fd67562
51434673ea6f20ab124feabc027c10190c49dc4a4addb779a3d7b07ae9fbe478
49659b7b7579dc466871c66e2f41e2f5077b31cf3bafcf09c0a4f433606414a9
aa28d635610aed2cf4c17cc09b35fa9bb4c4662ba8398451dcfd6e6ac68e8b07
a0c87b35d6843b8b2f5795bae15cfb087475f43dd59d2169b2b2c42316d75e74
c5a457f2af62e35eb0908ce7ccd45572ad0d234ba2559b9915038e6b781497ed
ee76e1e554788a6734694675ea37a791be7324382869d7308ed599be952ce10b
ebd0c00e05ecc376746d3d8a028bd1876cf25404ba8752e67b8f58bb2eca4860
1db4d5cc8c034a550006c583565c020b26858adca4e2a79c93fd45a23e95b966
2b0c4c99bbe59066baed089ea2345584dad109278a5a04b7da4e6c585b92b9f8
1081b56ac212e7729251024674941dd9858a667c4800c1bf8b422ddec2581983
0e9a0d2ad49ef84161da3d8b42f723e874a3c55350cd5f6167e79b3e701d64e9
177f9bd9837b06d864f51f1caaea862883d0bf0946393f00704056ca3449601e





